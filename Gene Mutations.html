<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Bio-Tech Mutation Lab - Final Version</title>
    <style>
        :root {
            --bg: #0a0e14;
            --panel: #161b22;
            --text: #c9d1d9;
            --accent: #58a6ff;
            --neon-a: #00ff88; --neon-t: #ff3e3e; --neon-c: #00d9ff; --neon-g: #ffcc00;
        }

        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; padding: 40px; display: flex; flex-direction: column; align-items: center; }
        
        #lab-container { width: 1000px; }

        .intro-text { font-style: italic; color: #8b949e; margin-bottom: 20px; text-align: center; }

        .section-box {
            background: var(--panel); border: 1px solid #30363d; border-radius: 12px;
            padding: 30px; margin-bottom: 30px;
        }

        h2 { color: var(--accent); font-size: 0.9rem; text-transform: uppercase; border-bottom: 1px solid #333; padding-bottom: 10px; margin-top: 0; }

        .dna-grid { display: flex; gap: 15px; align-items: center; justify-content: center; }
        .ellipsis { font-size: 1.5rem; color: #444; margin-top: 20px; font-weight: bold; }

        .codon-column { display: flex; flex-direction: column; align-items: center; gap: 12px; width: 90px; }
        .label { font-size: 0.65rem; color: #8b949e; font-weight: bold; height: 12px; }

        .base-group { display: flex; gap: 4px; }
        
        .base {
            width: 24px; height: 34px; display: flex; align-items: center; justify-content: center;
            border-radius: 4px; cursor: pointer; font-family: 'Courier New', monospace; font-weight: bold;
            background: rgba(255,255,255,0.1); border: 1px solid transparent;
            pointer-events: auto !important;
        }
        .base:hover { border-color: #fff; background: #30363d; }
        .base.A { color: var(--neon-a); } .base.T { color: var(--neon-t); }
        .base.C { color: var(--neon-c); } .base.G { color: var(--neon-g); }

        input {
            width: 75px; background: #0d1117; border: 1px solid #30363d;
            color: white; text-align: center; padding: 8px 0;
            font-family: 'Times New Roman', serif; font-size: 1.1rem; border-radius: 4px;
        }
        input::placeholder { color: #333; font-size: 0.8rem; }

        button {
            background: #21262d; border: 1px solid #444; color: var(--accent);
            padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: bold;
            margin: 15px 5px 0 0;
        }
        button:hover { background: var(--accent); color: white; }

        .reset-btn { background: #3e444d; color: #fff; margin-top: 40px; border-color: #6e7681; }
        .reset-btn:hover { background: #6e7681; }

        #context-menu {
            position: fixed; background: #1c2128; border: 2px solid var(--accent);
            display: none; flex-direction: column; z-index: 10000;
            border-radius: 8px; box-shadow: 0 10px 40px rgba(0,0,0,0.8);
            min-width: 150px;
        }
        .menu-item { padding: 12px 20px; cursor: pointer; border-bottom: 1px solid #333; font-size: 0.9rem; color: white; }
        .menu-item:hover { background: var(--accent); }

        #message { color: var(--neon-a); margin-top: 15px; font-weight: bold; display: none; padding: 10px; border: 1px solid; border-radius: 5px; }
        .shake { animation: shake 0.2s 2; border-color: #ff4d4d !important; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-4px); } 75% { transform: translateX(4px); } }
    </style>
</head>
<body>

<div id="lab-container">
    <div style="text-align: center; margin-bottom: 30px;">
        <a href="https://upload.wikimedia.org/wikipedia/commons/7/70/Aminoacids_table.svg" target="_blank" style="color: var(--accent); font-weight: bold; text-decoration: none; border: 2px solid var(--accent); padding: 12px 25px; border-radius: 8px;">ðŸ“– OPEN CODON TABLE</a>
    </div>

    <div class="intro-text">This simulation shows the sequence of 21 nucleotides that is part of a gene.</div>
    
    <div class="section-box">
        <h2>1. Wild-Type Baseline</h2>
        <div class="dna-grid">
            <span class="ellipsis">...</span>
            <div id="wt-grid" style="display:flex; gap:15px;"></div>
            <span class="ellipsis">...</span>
        </div>
        <button id="btn-wt-transcribe" onclick="transcribeWT()">Transcribe</button>
        <button id="btn-wt-translate" onclick="translateWT()" style="display:none;">Translate</button>
    </div>

    <div id="lab-section" class="section-box" style="display:none;">
        <h2>2. Mutation Laboratory</h2>
        <div class="dna-grid">
            <span class="ellipsis">...</span>
            <div id="lab-grid" style="display:flex; gap:15px;"></div>
            <span class="ellipsis">...</span>
        </div>
        <div style="margin-top:25px; border-top: 1px solid #333; padding-top: 20px;">
            <button onclick="checkmRNA()">Check mRNA</button>
            <button id="btn-check-protein" onclick="checkProtein()" style="display:none;">Check Amino Acids</button>
            <div id="message"></div>
        </div>
    </div>

    <div style="text-align: center;">
        <button class="reset-btn" onclick="resetSim()">ðŸ”„ Try Again (New Sequence)</button>
    </div>
</div>

<div id="context-menu"></div>

<script>
    const codonTable = {
        'UUU':'Phe','UUC':'Phe','UUA':'Leu','UUG':'Leu','CUU':'Leu','CUC':'Leu','CUA':'Leu','CUG':'Leu',
        'AUU':'Ile','AUC':'Ile','AUA':'Ile','AUG':'Met','GUU':'Val','GUC':'Val','GUA':'Val','GUG':'Val',
        'UCU':'Ser','UCC':'Ser','UCA':'Ser','UCG':'Ser','CCU':'Pro','CCC':'Pro','CCA':'Pro','CCG':'Pro',
        'ACU':'Thr','ACC':'Thr','ACA':'Thr','ACG':'Thr','GCU':'Ala','GCC':'Ala','GCA':'Ala','GCG':'Ala',
        'UAU':'Tyr','UAC':'Tyr','UAA':'STOP','UAG':'STOP','CAU':'His','CAC':'His','CAA':'Gln','CAG':'Gln',
        'AAU':'Asn','AAC':'Asn','AAA':'Lys','AAG':'Lys','GAU':'Asp','GAC':'Asp','GAA':'Glu','GAG':'Glu',
        'UGU':'Cys','UGC':'Cys','UGA':'STOP','UGG':'Trp','CGU':'Arg','CGC':'Arg','CGA':'Arg','CGG':'Arg',
        'AGU':'Ser','AGC':'Ser','AGA':'Arg','AGG':'Arg','GGU':'Gly','GGC':'Gly','GGA':'Gly','GGG':'Gly'
    };

    let dna = [];
    let wtDna = [];

    function init() {
        const bases = ['A','T','C','G'];
        const stops = ['ATT', 'ATC', 'ACT'];
        wtDna = [];
        for(let i=0; i<7; i++) {
            let c;
            do { c = bases[Math.floor(Math.random()*4)] + bases[Math.floor(Math.random()*4)] + bases[Math.floor(Math.random()*4)]; } while(stops.includes(c));
            wtDna.push(...c.split(''));
        }
        dna = [...wtDna];
        renderGrid('wt-grid', wtDna, false);
    }

    function renderGrid(id, seq, interactive) {
        const container = document.getElementById(id);
        container.innerHTML = '';
        for(let i=0; i<7; i++) {
            const col = document.createElement('div');
            col.className = 'codon-column';
            col.innerHTML += `<div class="label">${i===0?'DNA':''}</div>`;
            const bg = document.createElement('div');
            bg.className = 'base-group';
            for(let j=0; j<3; j++) {
                const idx = i*3 + j;
                const b = seq[idx] || 'A';
                const s = document.createElement('div');
                s.className = `base ${b}`;
                s.innerText = b;
                if(interactive) s.setAttribute('data-idx', idx);
                bg.appendChild(s);
            }
            col.appendChild(bg);
            col.innerHTML += `<div class="label">${i===0?'mRNA':''}</div><div id="${id}-m-${i}" style="color:#555">---</div>`;
            col.innerHTML += `<div class="label">${i===0?'Amino Acid':''}</div><div id="${id}-p-${i}" style="color:#555">---</div>`;
            container.appendChild(col);
        }
    }

    document.addEventListener('mousedown', function(e) {
        const base = e.target.closest('.base');
        const menu = document.getElementById('context-menu');
        if (base && base.hasAttribute('data-idx')) {
            e.preventDefault();
            const idx = parseInt(base.getAttribute('data-idx'));
            menu.style.display = 'flex';
            menu.style.left = e.clientX + 'px';
            menu.style.top = e.clientY + 'px';
            menu.innerHTML = `
                <div class="menu-item" onclick="handleMut(${idx},'del')">ðŸ—‘ DELETE</div>
                <div class="menu-item" onclick="showSub(${idx},'add')">âž• ADDITION</div>
                <div class="menu-item" onclick="showSub(${idx},'sub')">ðŸ”„ SUBSTITUTION</div>
            `;
        } else if (!e.target.closest('#context-menu')) {
            menu.style.display = 'none';
        }
    });

    window.showSub = function(idx, type) {
        const menu = document.getElementById('context-menu');
        menu.innerHTML = ['A','T','C','G'].map(b => 
            `<div class="menu-item" onclick="handleMut(${idx},'${type}','${b}')">${type==='sub'?'Change to':'Add'} ${b}</div>`
        ).join('');
    };

    window.handleMut = function(idx, type, val) {
        if(type==='del') dna.splice(idx, 1);
        else if(type==='sub') dna[idx] = val;
        else if(type==='add') dna.splice(idx, 0, val);
        while(dna.length < 21) dna.push(['A','T','C','G'][Math.floor(Math.random()*4)]);
        renderLab();
        document.getElementById('context-menu').style.display = 'none';
    };

    window.transcribeWT = function() {
        for(let i=0; i<7; i++) {
            const m = wtDna.slice(i*3, i*3+3).map(b => b==='T'?'A':(b==='A'?'U':(b==='C'?'G':'C'))).join('');
            document.getElementById(`wt-grid-m-${i}`).innerHTML = `<b style="color:#ff00ff">${m}</b>`;
        }
        document.getElementById('btn-wt-transcribe').style.display = 'none';
        document.getElementById('btn-wt-translate').style.display = 'inline';
    };

    window.translateWT = function() {
        for(let i=0; i<7; i++) {
            const m = wtDna.slice(i*3, i*3+3).map(b => b==='T'?'A':(b==='A'?'U':(b==='C'?'G':'C'))).join('');
            document.getElementById(`wt-grid-p-${i}`).innerText = codonTable[m];
        }
        document.getElementById('lab-section').style.display = 'block';
        renderLab();
    }

    function renderLab() {
        renderGrid('lab-grid', dna, true);
        for(let i=0; i<7; i++) {
            document.getElementById(`lab-grid-m-${i}`).innerHTML = `<input type="text" maxlength="3" id="lab-m-in-${i}" placeholder="RNA" oninput="this.value = this.value.toUpperCase()">`;
            document.getElementById(`lab-grid-p-${i}`).innerHTML = `<input type="text" id="lab-p-in-${i}" disabled placeholder="AA" oninput="this.value = this.value.toUpperCase()">`;
        }
        document.getElementById('message').style.display = 'none';
        document.getElementById('btn-check-protein').style.display = 'none';
    }

    window.checkmRNA = function() {
        let ok = true;
        for(let i=0; i<7; i++) {
            const inp = document.getElementById(`lab-m-in-${i}`);
            const correct = dna.slice(i*3, i*3+3).map(b => b==='T'?'A':(b==='A'?'U':(b==='C'?'G':'C'))).join('');
            if(inp.value.toUpperCase() !== correct) { inp.classList.add('shake'); setTimeout(()=>inp.classList.remove('shake'), 400); ok = false; }
        }
        if(ok) { 
            for(let i=0; i<7; i++) document.getElementById(`lab-p-in-${i}`).disabled = false;
            document.getElementById('btn-check-protein').style.display = 'inline';
        }
    }

    window.checkProtein = function() {
        let ok = true, stopped = false;
        for(let i=0; i<7; i++) {
            const inp = document.getElementById(`lab-p-in-${i}`);
            const m = dna.slice(i*3, i*3+3).map(b => b==='T'?'A':(b==='A'?'U':(b==='C'?'G':'C'))).join('');
            const target = stopped ? "" : (codonTable[m] || "???");
            if(inp.value.toUpperCase() !== target.toUpperCase()) { inp.classList.add('shake'); setTimeout(()=>inp.classList.remove('shake'), 400); ok = false; }
            if(target === 'STOP') stopped = true;
        }
        if(ok) { document.getElementById('message').innerText = "That's Right! Can you identify the effect of your mutation?"; document.getElementById('message').style.display = "block"; }
    }

    window.resetSim = function() {
        document.getElementById('lab-section').style.display = 'none';
        document.getElementById('btn-wt-transcribe').style.display = 'inline';
        document.getElementById('btn-wt-translate').style.display = 'none';
        document.getElementById('message').style.display = 'none';
        init();
    }

    init();
</script>
</body>
</html>